version: 1.0
runtime: nodejs20
build:
  commands:
    pre_build:
      # Install frontend dependencies
      - echo "üì¶ Installing frontend dependencies..."
      - npm ci
      # Build frontend React application
      - echo "üèóÔ∏è  Building frontend application..."
      - npm run build
      # Install backend dependencies
      - echo "üì¶ Installing backend dependencies..."
      - cd backend
      - npm ci --production
      # Return to root directory
      - cd ..
    build:
      - echo "‚úÖ Build completed successfully!"
      - echo "Frontend built to: ./dist"
      - echo "Backend dependencies installed in: ./backend"
run:
  runtime-version: 20
  command: node backend/server.js
  network:
    port: 8080
    env: PORT
  env:
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "8080"
    # Database configuration - these should be set in App Runner environment variables or Secrets Manager
    # AWS App Runner will automatically inject these from the service configuration
    # Example environment variables to set in App Runner console:
    # - DB_HOST (e.g., your-rds-endpoint.region.rds.amazonaws.com)
    # - DB_PORT (default: 5432)
    # - DB_NAME (your database name)
    # - DB_USER (your database username)
    # - DB_PASSWORD (store in AWS Secrets Manager for security)
    # - GEMINI_API_KEY (store in AWS Secrets Manager for security)
    # - VITE_API_URL (optional: if different from default, set to your App Runner service URL)